{"ast":null,"code":"import httpApi from '../../http';\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue';\nexport default {\n  components: {\n    Editor,\n    Toolbar\n  },\n  data() {\n    return {\n      loading: false,\n      actors: [],\n      editor: null,\n      toolbarConfig: {},\n      editorConfig: {\n        placeholder: '请输入内容...'\n      },\n      mode: 'default',\n      // or 'simple'\n      colors: ['#99A9BF', '#F7BA2A', '#FF9900'],\n      form: {\n        cover: '',\n        categoryid: 1,\n        title: '',\n        type: '',\n        starActor: '',\n        showingon: '',\n        score: 4,\n        duration: '<p>hello</p>',\n        description: ''\n      },\n      rules: {\n        cover: [{\n          required: true,\n          message: '该字段必填',\n          trigger: 'blur'\n        }],\n        categoryid: [{\n          required: true,\n          message: '该字段必填',\n          trigger: 'blur'\n        }],\n        title: [{\n          required: true,\n          message: '该字段必填',\n          trigger: 'blur'\n        }],\n        type: [{\n          required: true,\n          message: '该字段必填',\n          trigger: 'blur'\n        }],\n        starActor: [{\n          required: true,\n          message: '该字段必填',\n          trigger: 'blur'\n        }],\n        showingon: [{\n          required: true,\n          message: '该字段必填',\n          trigger: 'blur'\n        }],\n        score: [{\n          required: true,\n          message: '该字段必填',\n          trigger: 'blur'\n        }],\n        duration: [{\n          required: true,\n          message: '该字段必填',\n          trigger: 'blur'\n        }],\n        description: [{\n          required: true,\n          message: '该字段必填',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  methods: {\n    onCreated(editor) {\n      this.editor = Object.seal(editor); // 一定要用 Object.seal() ，否则会报错\n    },\n\n    remoteMethod(query) {\n      httpApi.actorApi.queryActorByName({\n        name: query\n      }).then(res => {\n        this.actors = res.data;\n      });\n    },\n    // 提交表单\n    submit() {\n      this.$refs['form'].validate(valid => {\n        if (valid) {\n          httpApi.actorApi.addActor(this.form).then(res => {\n            console.log('新增演员', res);\n            this.$message({\n              message: '恭喜添加成功',\n              type: 'success'\n            });\n            // 重置表单将会重置每个表单项，需要form-item提供prop属性\n            this.$refs['form'].resetFields();\n          });\n        }\n      });\n    },\n    // 上传成功后执行\n    handleAvatarSuccess(res, file) {\n      console.log('上传成功', res);\n      // 将返回的图片访问路径 存入 this.form中\n      this.form.cover = res.data;\n    },\n    // 头像上传前执行：格式、大小的验证，该方法需要返回true、false\n    // true:  验证通过可以上传\n    // false: 验证不通过，阻止上传\n    beforeAvatarUpload(file) {\n      const isJPG = file.type === 'image/jpeg';\n      const isPNG = file.type === 'image/png';\n      const isLt2M = file.size / 1024 / 1024 < 2;\n      if (!(isJPG || isPNG)) {\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式且大小不能超过 2MB!');\n      } else if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n      return (isJPG || isPNG) && isLt2M;\n    }\n  },\n  beforeDestroy() {\n    const editor = this.editor;\n    if (editor == null) return;\n    editor.destroy(); // 组件销毁时，及时销毁编辑器\n  }\n};","map":{"version":3,"names":["httpApi","Editor","Toolbar","components","data","loading","actors","editor","toolbarConfig","editorConfig","placeholder","mode","colors","form","cover","categoryid","title","type","starActor","showingon","score","duration","description","rules","required","message","trigger","methods","onCreated","Object","seal","remoteMethod","query","actorApi","queryActorByName","name","then","res","submit","$refs","validate","valid","addActor","console","log","$message","resetFields","handleAvatarSuccess","file","beforeAvatarUpload","isJPG","isPNG","isLt2M","size","error","beforeDestroy","destroy"],"sources":["src/views/movie/MovieAdd.vue"],"sourcesContent":["<template>\r\n\t<div>\r\n\t\t<el-breadcrumb separator-class=\"el-icon-arrow-right\">\r\n\t\t\t<el-breadcrumb-item :to=\"{ path: '/home/index' }\">首页</el-breadcrumb-item>\r\n\t\t\t<el-breadcrumb-item>电影管理</el-breadcrumb-item>\r\n\t\t\t<el-breadcrumb-item>新增电影</el-breadcrumb-item>\r\n\t\t</el-breadcrumb>\r\n\t\t<el-divider></el-divider>\r\n\t\t<!-- 表单 -->\r\n\t\t<el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"100px\" style=\"width: 600px\">\r\n\t\t\t<el-form-item label=\"封面图片\" prop=\"cover\">\r\n\t\t\t\t<el-upload\r\n\t\t\t\t\tclass=\"avatar-uploader\"\r\n\t\t\t\t\t:action=\"`${UPLOADURL}/upload`\"\r\n\t\t\t\t\t:show-file-list=\"false\"\r\n\t\t\t\t\t:on-success=\"handleAvatarSuccess\"\r\n\t\t\t\t\t:before-upload=\"beforeAvatarUpload\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<img style=\"object-fit: cover\" v-if=\"form.cover\" :src=\"form.cover\" class=\"avatar\" />\r\n\t\t\t\t\t<i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n\t\t\t\t</el-upload>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"电影类别\" prop=\"categoryid\">\r\n\t\t\t\t<el-radio-group v-model=\"form.categoryid\">\r\n\t\t\t\t\t<el-radio :label=\"1\">热映</el-radio>\r\n\t\t\t\t\t<el-radio :label=\"2\">待映</el-radio>\r\n\t\t\t\t\t<el-radio :label=\"3\">经典</el-radio>\r\n\t\t\t\t</el-radio-group>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"电影名称\" prop=\"title\">\r\n\t\t\t\t<el-input v-model=\"form.title\" placeholder=\"请输入要添加的电影名称\" />\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"电影类型\" prop=\"type\">\r\n\t\t\t\t<el-select v-model=\"form.type\" multiple placeholder=\"请选择电影类型\">\r\n\t\t\t\t\t<el-option\r\n\t\t\t\t\t\tv-for=\"item in options\"\r\n\t\t\t\t\t\t:key=\"item.value\"\r\n\t\t\t\t\t\t:label=\"item.label\"\r\n\t\t\t\t\t\t:value=\"item.value\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t</el-option>\r\n\t\t\t\t</el-select>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"电影主演\" prop=\"starActor\">\r\n\t\t\t\t<el-select\r\n\t\t\t\t\tv-model=\"form.starActor\"\r\n\t\t\t\t\tmultiple\r\n\t\t\t\t\tfilterable\r\n\t\t\t\t\tremote\r\n\t\t\t\t\treserve-keyword\r\n\t\t\t\t\tplaceholder=\"请输入主演名称\"\r\n\t\t\t\t\t:remote-method=\"remoteMethod\"\r\n\t\t\t\t\t:loading=\"loading\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<el-option\r\n\t\t\t\t\t\tv-for=\"item in actors\"\r\n\t\t\t\t\t\t:key=\"item.value\"\r\n\t\t\t\t\t\t:label=\"item.label\"\r\n\t\t\t\t\t\t:value=\"item.value\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t</el-option>\r\n\t\t\t\t</el-select>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"上映时间\" prop=\"showingon\">\r\n\t\t\t\t<el-date-picker\r\n\t\t\t\t\ttype=\"date\"\r\n\t\t\t\t\tplaceholder=\"选择日期\"\r\n\t\t\t\t\tvalue-format=\"yyyy-m-d\"\r\n\t\t\t\t\tv-model=\"form.showingon\"\r\n\t\t\t\t\tstyle=\"width: 100%\"\r\n\t\t\t\t></el-date-picker>\r\n\t\t\t</el-form-item>\r\n\r\n\t\t\t<el-form-item label=\"电影评分\" prop=\"score\">\r\n\t\t\t\t<el-rate\r\n\t\t\t\t\tstyle=\"height: 40px; display: flex; align-items: center\"\r\n\t\t\t\t\tv-model=\"form.score\"\r\n\t\t\t\t\t:colors=\"colors\"\r\n\t\t\t\t>\r\n\t\t\t\t</el-rate>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"电影时长\" prop=\"duration\">\r\n\t\t\t\t<el-input v-model=\"form.duration\" />\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item label=\"电影简介\" prop=\"description\">\r\n\t\t\t\t<div style=\"border: 1px solid #ccc\">\r\n\t\t\t\t\t<Toolbar\r\n\t\t\t\t\t\tstyle=\"border-bottom: 1px solid #ccc\"\r\n\t\t\t\t\t\t:editor=\"editor\"\r\n\t\t\t\t\t\t:defaultConfig=\"toolbarConfig\"\r\n\t\t\t\t\t\t:mode=\"mode\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Editor\r\n\t\t\t\t\t\tstyle=\"height: 300px; overflow-y: hidden\"\r\n\t\t\t\t\t\tv-model=\"form.description\"\r\n\t\t\t\t\t\t:defaultConfig=\"editorConfig\"\r\n\t\t\t\t\t\t:mode=\"mode\"\r\n\t\t\t\t\t\t@onCreated=\"onCreated\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</el-form-item>\r\n\t\t\t<el-form-item>\r\n\t\t\t\t<el-button type=\"primary\" @click=\"submit\">立即创建</el-button>\r\n\t\t\t\t<el-button>取消</el-button>\r\n\t\t\t</el-form-item>\r\n\t\t</el-form>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport httpApi from '../../http';\r\n\r\n\timport { Editor, Toolbar } from '@wangeditor/editor-for-vue';\r\n\texport default {\r\n\t\tcomponents: { Editor, Toolbar },\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tloading: false,\r\n\t\t\t\tactors: [],\r\n\t\t\t\teditor: null,\r\n\t\t\t\ttoolbarConfig: {},\r\n\t\t\t\teditorConfig: { placeholder: '请输入内容...' },\r\n\t\t\t\tmode: 'default', // or 'simple'\r\n\t\t\t\tcolors: ['#99A9BF', '#F7BA2A', '#FF9900'],\r\n\t\t\t\tform: {\r\n\t\t\t\t\tcover: '',\r\n\t\t\t\t\tcategoryid: 1,\r\n\t\t\t\t\ttitle: '',\r\n\t\t\t\t\ttype: '',\r\n\t\t\t\t\tstarActor: '',\r\n\t\t\t\t\tshowingon: '',\r\n\t\t\t\t\tscore: 4,\r\n\t\t\t\t\tduration: '<p>hello</p>',\r\n\t\t\t\t\tdescription: '',\r\n\t\t\t\t},\r\n\t\t\t\trules: {\r\n\t\t\t\t\tcover: [{ required: true, message: '该字段必填', trigger: 'blur' }],\r\n\t\t\t\t\tcategoryid: [{ required: true, message: '该字段必填', trigger: 'blur' }],\r\n\t\t\t\t\ttitle: [{ required: true, message: '该字段必填', trigger: 'blur' }],\r\n\t\t\t\t\ttype: [{ required: true, message: '该字段必填', trigger: 'blur' }],\r\n\t\t\t\t\tstarActor: [{ required: true, message: '该字段必填', trigger: 'blur' }],\r\n\t\t\t\t\tshowingon: [{ required: true, message: '该字段必填', trigger: 'blur' }],\r\n\t\t\t\t\tscore: [{ required: true, message: '该字段必填', trigger: 'blur' }],\r\n\t\t\t\t\tduration: [{ required: true, message: '该字段必填', trigger: 'blur' }],\r\n\t\t\t\t\tdescription: [{ required: true, message: '该字段必填', trigger: 'blur' }],\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tonCreated(editor) {\r\n\t\t\t\tthis.editor = Object.seal(editor); // 一定要用 Object.seal() ，否则会报错\r\n\t\t\t},\r\n\t\t\tremoteMethod(query) {\r\n\t\t\t\thttpApi.actorApi.queryActorByName({ name: query }).then((res) => {\r\n\t\t\t\t\tthis.actors = res.data;\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 提交表单\r\n\t\t\tsubmit() {\r\n\t\t\t\tthis.$refs['form'].validate((valid) => {\r\n\t\t\t\t\tif (valid) {\r\n\t\t\t\t\t\thttpApi.actorApi.addActor(this.form).then((res) => {\r\n\t\t\t\t\t\t\tconsole.log('新增演员', res);\r\n\t\t\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\t\t\tmessage: '恭喜添加成功',\r\n\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// 重置表单将会重置每个表单项，需要form-item提供prop属性\r\n\t\t\t\t\t\t\tthis.$refs['form'].resetFields();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t// 上传成功后执行\r\n\t\t\thandleAvatarSuccess(res, file) {\r\n\t\t\t\tconsole.log('上传成功', res);\r\n\t\t\t\t// 将返回的图片访问路径 存入 this.form中\r\n\t\t\t\tthis.form.cover = res.data;\r\n\t\t\t},\r\n\r\n\t\t\t// 头像上传前执行：格式、大小的验证，该方法需要返回true、false\r\n\t\t\t// true:  验证通过可以上传\r\n\t\t\t// false: 验证不通过，阻止上传\r\n\t\t\tbeforeAvatarUpload(file) {\r\n\t\t\t\tconst isJPG = file.type === 'image/jpeg';\r\n\t\t\t\tconst isPNG = file.type === 'image/png';\r\n\t\t\t\tconst isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n\t\t\t\tif (!(isJPG || isPNG)) {\r\n\t\t\t\t\tthis.$message.error('上传头像图片只能是 JPG/PNG 格式且大小不能超过 2MB!');\r\n\t\t\t\t} else if (!isLt2M) {\r\n\t\t\t\t\tthis.$message.error('上传头像图片大小不能超过 2MB!');\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn (isJPG || isPNG) && isLt2M;\r\n\t\t\t},\r\n\t\t},\r\n\t\tbeforeDestroy() {\r\n\t\t\tconst editor = this.editor;\r\n\t\t\tif (editor == null) return;\r\n\t\t\teditor.destroy(); // 组件销毁时，及时销毁编辑器\r\n\t\t},\r\n\t};\r\n</script>\r\n<style src=\"@wangeditor/editor/dist/css/style.css\"></style>\r\n<style lang=\"scss\" scoped></style>\r\n\r\n<style>\r\n\t.avatar-uploader .el-upload {\r\n\t\tborder: 1px dashed #d9d9d9;\r\n\t\tborder-radius: 6px;\r\n\t\tcursor: pointer;\r\n\t\tposition: relative;\r\n\t\toverflow: hidden;\r\n\t}\r\n\t.avatar-uploader .el-upload:hover {\r\n\t\tborder-color: #409eff;\r\n\t}\r\n\t.avatar-uploader-icon {\r\n\t\tfont-size: 28px;\r\n\t\tcolor: #8c939d;\r\n\t\twidth: 120px;\r\n\t\theight: 120px;\r\n\t\tline-height: 120px;\r\n\t\ttext-align: center;\r\n\t}\r\n\t.avatar {\r\n\t\twidth: 120px;\r\n\t\theight: 120px;\r\n\t\tdisplay: block;\r\n\t}\r\n</style>\r\n"],"mappings":"AA8GA,OAAAA,OAAA;AAEA,SAAAC,MAAA,EAAAC,OAAA;AACA;EACAC,UAAA;IAAAF,MAAA;IAAAC;EAAA;EACAE,KAAA;IACA;MACAC,OAAA;MACAC,MAAA;MACAC,MAAA;MACAC,aAAA;MACAC,YAAA;QAAAC,WAAA;MAAA;MACAC,IAAA;MAAA;MACAC,MAAA;MACAC,IAAA;QACAC,KAAA;QACAC,UAAA;QACAC,KAAA;QACAC,IAAA;QACAC,SAAA;QACAC,SAAA;QACAC,KAAA;QACAC,QAAA;QACAC,WAAA;MACA;MACAC,KAAA;QACAT,KAAA;UAAAU,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAX,UAAA;UAAAS,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAV,KAAA;UAAAQ,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAT,IAAA;UAAAO,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAR,SAAA;UAAAM,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAP,SAAA;UAAAK,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAN,KAAA;UAAAI,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAL,QAAA;UAAAG,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAJ,WAAA;UAAAE,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;MACA;IACA;EACA;EACAC,OAAA;IACAC,UAAArB,MAAA;MACA,KAAAA,MAAA,GAAAsB,MAAA,CAAAC,IAAA,CAAAvB,MAAA;IACA;;IACAwB,aAAAC,KAAA;MACAhC,OAAA,CAAAiC,QAAA,CAAAC,gBAAA;QAAAC,IAAA,EAAAH;MAAA,GAAAI,IAAA,CAAAC,GAAA;QACA,KAAA/B,MAAA,GAAA+B,GAAA,CAAAjC,IAAA;MACA;IACA;IACA;IACAkC,OAAA;MACA,KAAAC,KAAA,SAAAC,QAAA,CAAAC,KAAA;QACA,IAAAA,KAAA;UACAzC,OAAA,CAAAiC,QAAA,CAAAS,QAAA,MAAA7B,IAAA,EAAAuB,IAAA,CAAAC,GAAA;YACAM,OAAA,CAAAC,GAAA,SAAAP,GAAA;YACA,KAAAQ,QAAA;cACApB,OAAA;cACAR,IAAA;YACA;YACA;YACA,KAAAsB,KAAA,SAAAO,WAAA;UACA;QACA;MACA;IACA;IAEA;IACAC,oBAAAV,GAAA,EAAAW,IAAA;MACAL,OAAA,CAAAC,GAAA,SAAAP,GAAA;MACA;MACA,KAAAxB,IAAA,CAAAC,KAAA,GAAAuB,GAAA,CAAAjC,IAAA;IACA;IAEA;IACA;IACA;IACA6C,mBAAAD,IAAA;MACA,MAAAE,KAAA,GAAAF,IAAA,CAAA/B,IAAA;MACA,MAAAkC,KAAA,GAAAH,IAAA,CAAA/B,IAAA;MACA,MAAAmC,MAAA,GAAAJ,IAAA,CAAAK,IAAA;MAEA,MAAAH,KAAA,IAAAC,KAAA;QACA,KAAAN,QAAA,CAAAS,KAAA;MACA,YAAAF,MAAA;QACA,KAAAP,QAAA,CAAAS,KAAA;MACA;MAEA,QAAAJ,KAAA,IAAAC,KAAA,KAAAC,MAAA;IACA;EACA;EACAG,cAAA;IACA,MAAAhD,MAAA,QAAAA,MAAA;IACA,IAAAA,MAAA;IACAA,MAAA,CAAAiD,OAAA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}