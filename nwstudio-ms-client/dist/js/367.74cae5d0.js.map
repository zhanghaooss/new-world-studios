{"version":3,"file":"js/367.74cae5d0.js","mappings":"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","sources":["webpack://bmdstudio-ms-client/./src/views/cinema/CinemaRoomSeatTemplate.vue","webpack://bmdstudio-ms-client/./src/libs/SeatSelector.js","webpack://bmdstudio-ms-client/src/views/cinema/CinemaRoomSeatTemplate.vue","webpack://bmdstudio-ms-client/./src/views/cinema/CinemaRoomSeatTemplate.vue?9f89","webpack://bmdstudio-ms-client/./src/views/cinema/CinemaRoomSeatTemplate.vue?02af"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('el-divider'),_c('el-container',[_c('el-aside',[_c('el-timeline',[_c('el-timeline-item',[_c('el-card',{staticClass:\"box-card\"},[_c('div',{staticClass:\"clearfix\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('span',[_vm._v(\"编辑坐标系\")])]),_c('el-form',{attrs:{\"label-width\":\"60px\"}},[_c('el-form-item',{attrs:{\"label\":\"行数\"}},[_c('el-input',{attrs:{\"placeholder\":\"请输入行数\",\"size\":\"small\"},model:{value:(_vm.rows),callback:function ($$v) {_vm.rows=$$v},expression:\"rows\"}})],1),_c('el-form-item',{attrs:{\"label\":\"列数\"}},[_c('el-input',{attrs:{\"placeholder\":\"请输入列数\",\"size\":\"small\"},model:{value:(_vm.cols),callback:function ($$v) {_vm.cols=$$v},expression:\"cols\"}})],1),_c('el-button',{staticStyle:{\"width\":\"100%\"},attrs:{\"type\":\"primary\",\"plain\":\"\",\"size\":\"small\"},on:{\"click\":function($event){return _vm.step1()}}},[_vm._v(\" 生成座位模板 \")])],1)],1)],1),_c('el-timeline-item',[_c('el-card',{staticClass:\"box-card\"},[_c('div',{staticClass:\"clearfix\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('span',[_vm._v(\"选择座位区域（框选）\")])]),_c('el-button',{staticStyle:{\"width\":\"100%\"},attrs:{\"type\":\"primary\",\"plain\":\"\",\"size\":\"small\"},on:{\"click\":function($event){return _vm.step2()}}},[_vm._v(\" 撤销选中 \")])],1)],1),_c('el-timeline-item',[_c('el-card',{staticClass:\"box-card\"},[_c('div',{staticClass:\"clearfix\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('span',[_vm._v(\"选择座位类型\")])]),_c('el-button',{staticStyle:{\"width\":\"100%\"},attrs:{\"type\":\"primary\",\"plain\":\"\",\"size\":\"small\"},on:{\"click\":function($event){return _vm.step3_1()}}},[_vm._v(\" 普通座位 \")]),_c('br'),_c('br'),_c('el-button',{staticStyle:{\"width\":\"100%\"},attrs:{\"type\":\"primary\",\"plain\":\"\",\"size\":\"small\"},on:{\"click\":function($event){return _vm.step3_2()}}},[_vm._v(\" 过道 \")])],1)],1),_c('el-timeline-item',[_c('el-card',{staticClass:\"box-card\"},[_c('div',{staticClass:\"clearfix\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('span',[_vm._v(\"确认模板\")])]),_c('el-button',{staticStyle:{\"width\":\"100%\"},attrs:{\"type\":\"success\",\"size\":\"small\"},on:{\"click\":function($event){return _vm.step4()}}},[_vm._v(\" 选好了 \")])],1)],1)],1)],1),_c('el-main',[_c('div',{staticClass:\"tip\"},[_c('div',{staticClass:\"tip-item\",staticStyle:{\"background\":\"#36d6\"}}),_vm._v(\" 未选择座位    \"),_c('div',{staticClass:\"tip-item\",staticStyle:{\"background\":\"#36d\"}}),_vm._v(\" 已选择座位    \"),_c('div',{staticClass:\"tip-item\",staticStyle:{\"background\":\"#a11\"}}),_vm._v(\" 普通座位    \"),_c('div',{staticClass:\"tip-item\",staticStyle:{\"background\":\"#3333\"}}),_vm._v(\" 过道 \")]),_c('el-divider'),_c('el-divider',[_vm._v(\"电影荧屏\")]),_c('canvas',{attrs:{\"id\":\"canvas\"}})],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\r\n * 描述座位\r\n */\r\nclass Seat {\r\n  constructor(x, y) {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.type = 0; // 座位类型 0:未分配   1:普通座位   2:过道\r\n    this.selected = false; //指定当前作为是否为选中状态\r\n  }\r\n}\r\n\r\n/**\r\n * 描述座位选择面板\r\n */\r\nclass SeatSelector {\r\n  //构造器，new创建对象时为属性赋值\r\n  constructor(rows, cols, canvasId) {\r\n    this.rows = rows;\r\n    this.cols = cols;\r\n    this.canvas = document.getElementById(canvasId);\r\n    this.cvs = canvas.getContext(\"2d\");\r\n    // 自定义一些属性\r\n    this.seatSize = 20; // 指定每一个座位的宽高像素值\r\n    this.margin = 5; // 指定座位与座位之间的缝隙像素值\r\n\r\n    // 初始化座位模板   （二维数组，每个元素都是一个Seat对象）\r\n    this.seats = [];\r\n    for (let i = 0; i < rows; i++) {\r\n      let row = [];\r\n      for (let j = 0; j < cols; j++) {\r\n        row[j] = new Seat(i, j);\r\n      }\r\n      this.seats[i] = row;\r\n    }\r\n\r\n    // 为canvas初始化width与height\r\n    this.canvas.width = cols * this.seatSize + (cols + 1) * this.margin;\r\n    this.canvas.height = rows * this.seatSize + (rows + 1) * this.margin;\r\n    this.canvas.style.display = \"block\";\r\n\r\n    // 为canvas绑定事件\r\n    this.canvas.addEventListener(\"mousedown\", (event) => {\r\n      let rect = this.canvas.getBoundingClientRect(); // 获取canvas在网页中的矩形区域\r\n      let x = event.clientX - rect.left;\r\n      let y = event.clientY - rect.top;\r\n      // 记录一下这个起始坐标点\r\n      this.startPoint = { x, y };\r\n    });\r\n\r\n    // 为canvas绑定事件\r\n    this.canvas.addEventListener(\"mouseup\", (event) => {\r\n      let rect = this.canvas.getBoundingClientRect(); // 获取canvas在网页中的矩形区域\r\n      let x = event.clientX - rect.left;\r\n      let y = event.clientY - rect.top;\r\n      // 记录一下这个起始坐标点\r\n      this.endPoint = { x, y };\r\n\r\n      // 根据起始点与结束点，整理出来一个矩形框对象： {x1,y1, x2,y2}   左上角点坐标   右下角点坐标\r\n      let selectRect = {\r\n        x1: Math.min(this.startPoint.x, this.endPoint.x),\r\n        y1: Math.min(this.startPoint.y, this.endPoint.y),\r\n        x2: Math.max(this.startPoint.x, this.endPoint.x),\r\n        y2: Math.max(this.startPoint.y, this.endPoint.y),\r\n      };\r\n\r\n      // 判断每个座位是否在该矩形框内，如果是，则改变座位的selected属性\r\n      // 遍历每一个座位\r\n      for (let i = 0; i < this.rows; i++) {\r\n        for (let j = 0; j < this.cols; j++) {\r\n          // 获取每一个座位\r\n          let seat = this.seats[i][j];\r\n          // 计算该座位在canvas中的上、下、左、右边界值\r\n          let top = i * this.seatSize + (i + 1) * this.margin;\r\n          let bottom = (i + 1) * this.seatSize + (i + 1) * this.margin;\r\n          let left = j * this.seatSize + (j + 1) * this.margin;\r\n          let right = (j + 1) * this.seatSize + (j + 1) * this.margin;\r\n          // 经过判断，判断该座位是否不在矩形框\r\n          if (\r\n            top > selectRect.y2 ||\r\n            left > selectRect.x2 ||\r\n            bottom < selectRect.y1 ||\r\n            right < selectRect.x1\r\n          ) {\r\n            // 没框住该座位\r\n          } else {\r\n            if (seat.type == 0) {\r\n              //当前座位还未分配\r\n              seat.selected = !seat.selected;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      this.draw();\r\n    });\r\n  }\r\n\r\n  /** 绘制canvas中的内容 */\r\n  draw() {\r\n    // 清除所有像素点\r\n    this.cvs.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    // 绘制每一个座位\r\n    for (let i = 0; i < this.rows; i++) {\r\n      for (let j = 0; j < this.cols; j++) {\r\n        // 根据当前座位类型的不同，绘制不同的样式\r\n        let seat = this.seats[i][j];\r\n        \r\n        // 根据座位的类型，设置不同的颜色\r\n        if (seat.type == 1) {\r\n          // 普通座位 设置为红色\r\n          this.cvs.fillStyle = \"#a11\";\r\n          this.cvs.fillRect(\r\n            j * this.seatSize + (j + 1) * this.margin,\r\n            i * this.seatSize + (i + 1) * this.margin,\r\n            this.seatSize,\r\n            this.seatSize\r\n          );\r\n          continue;\r\n        }\r\n\r\n        // 根据座位的类型，设置不同的颜色\r\n        if (seat.type == 2) {\r\n          this.cvs.fillStyle = \"#3333\";\r\n          this.cvs.fillRect(\r\n            j * this.seatSize + (j + 1) * this.margin,\r\n            i * this.seatSize + (i + 1) * this.margin,\r\n            this.seatSize,\r\n            this.seatSize\r\n          );\r\n          continue;\r\n        }\r\n        // 根据座位的选中未选中，设置不同的颜色\r\n        if (seat.selected) {\r\n          this.cvs.fillStyle = \"#36D\";\r\n          this.cvs.fillRect(\r\n            j * this.seatSize + (j + 1) * this.margin,\r\n            i * this.seatSize + (i + 1) * this.margin,\r\n            this.seatSize,\r\n            this.seatSize\r\n          );\r\n        } else {\r\n          this.cvs.fillStyle = \"#36D6\";\r\n          this.cvs.fillRect(\r\n            j * this.seatSize + (j + 1) * this.margin,\r\n            i * this.seatSize + (i + 1) * this.margin,\r\n            this.seatSize,\r\n            this.seatSize\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 将所有的作为都设置为未选中，然后重新绘制即可\r\n   */\r\n  setNoSelect() {\r\n    for (let i = 0; i < this.rows; i++) {\r\n      for (let j = 0; j < this.cols; j++) {\r\n        let seat = this.seats[i][j];\r\n        seat.selected = false;\r\n      }\r\n    }\r\n    this.draw();\r\n  }\r\n\r\n  /**\r\n   * 将选中的座位的类型改为普通座位：type:1\r\n   */\r\n  setSelectedSeatsToNormalSeats() {\r\n    for (let i = 0; i < this.rows; i++) {\r\n      for (let j = 0; j < this.cols; j++) {\r\n        let seat = this.seats[i][j];\r\n        if (seat.selected) {\r\n          seat.type = 1;\r\n          seat.selected = false; // 将选中状态设置为false\r\n        }\r\n      }\r\n    }\r\n    this.draw();\r\n  }\r\n\r\n  /**\r\n   * 将选中的座位的类型改为过道：type:2\r\n   */\r\n  setSelectedSeatsToGangway() {\r\n    for (let i = 0; i < this.rows; i++) {\r\n      for (let j = 0; j < this.cols; j++) {\r\n        let seat = this.seats[i][j];\r\n        if (seat.selected) {\r\n          seat.type = 2;\r\n          seat.selected = false; // 将选中状态设置为false\r\n        }\r\n      }\r\n    }\r\n    this.draw();\r\n  }\r\n\r\n  /**\r\n   * 获取座位模板的json字符串\r\n   */\r\n  getSeatTemplateJsonString(){\r\n    let rowNum = 0\r\n    for (let i = 0; i < this.rows; i++) {\r\n      // 判断当前这一排有没有不是过道的座位\r\n      let rowData = this.seats[i]  // 当前这一排数据\r\n      let filteredRowData = rowData.filter((item)=>{return item.type != 2})\r\n      if(filteredRowData.length == 0){\r\n        continue;\r\n      }\r\n      // 记录排号\r\n      rowNum += 1\r\n\r\n      // 记录列号\r\n      let colNum = 0\r\n      for (let j = 0; j < this.cols; j++) {\r\n        let seat = this.seats[i][j];\r\n        if (seat.type==0) {\r\n          throw \"还有未分配的座位\"\r\n        }else if(seat.type==1){\r\n          colNum += 1\r\n          seat.name = `${rowNum}排${colNum}号`\r\n        }\r\n      }\r\n    }\r\n    let str = JSON.stringify(this.seats)\r\n    return str\r\n  }\r\n\r\n  /**\r\n   * 获取模版中所有的座位数量\r\n   */\r\n  getSeatCount(){\r\n    let count = 0\r\n    for (let i = 0; i < this.rows; i++) {\r\n      for (let j = 0; j < this.cols; j++) {\r\n        let seat = this.seats[i][j];\r\n        if (seat.type==1) {\r\n          count++;\r\n        }\r\n      }\r\n    }\r\n    return count;\r\n  }\r\n}\r\n\r\nexport default SeatSelector;\r\n","<template>\r\n\t<div>\r\n\t\t<!-- 面包屑导航 -->\r\n\r\n\t\t<el-divider></el-divider>\r\n\r\n\t\t<!-- 配置座位模板内容 -->\r\n\t\t<el-container>\r\n\t\t\t<el-aside>\r\n\t\t\t\t<!-- 时间线 -->\r\n\t\t\t\t<el-timeline>\r\n\t\t\t\t\t<!-- 第一步 -->\r\n\t\t\t\t\t<el-timeline-item>\r\n\t\t\t\t\t\t<el-card class=\"box-card\">\r\n\t\t\t\t\t\t\t<div slot=\"header\" class=\"clearfix\">\r\n\t\t\t\t\t\t\t\t<span>编辑坐标系</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<el-form label-width=\"60px\">\r\n\t\t\t\t\t\t\t\t<el-form-item label=\"行数\">\r\n\t\t\t\t\t\t\t\t\t<el-input v-model=\"rows\" placeholder=\"请输入行数\" size=\"small\" />\r\n\t\t\t\t\t\t\t\t</el-form-item>\r\n\t\t\t\t\t\t\t\t<el-form-item label=\"列数\">\r\n\t\t\t\t\t\t\t\t\t<el-input v-model=\"cols\" placeholder=\"请输入列数\" size=\"small\" />\r\n\t\t\t\t\t\t\t\t</el-form-item>\r\n\t\t\t\t\t\t\t\t<el-button type=\"primary\" plain style=\"width: 100%\" size=\"small\" @click=\"step1()\">\r\n\t\t\t\t\t\t\t\t\t生成座位模板\r\n\t\t\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t\t\t</el-form>\r\n\t\t\t\t\t\t</el-card>\r\n\t\t\t\t\t</el-timeline-item>\r\n\t\t\t\t\t<!-- 第二步 -->\r\n\t\t\t\t\t<el-timeline-item>\r\n\t\t\t\t\t\t<el-card class=\"box-card\">\r\n\t\t\t\t\t\t\t<div slot=\"header\" class=\"clearfix\">\r\n\t\t\t\t\t\t\t\t<span>选择座位区域（框选）</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<el-button type=\"primary\" plain style=\"width: 100%\" size=\"small\" @click=\"step2()\">\r\n\t\t\t\t\t\t\t\t撤销选中\r\n\t\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t\t</el-card>\r\n\t\t\t\t\t</el-timeline-item>\r\n\r\n\t\t\t\t\t<!-- 第三步 -->\r\n\t\t\t\t\t<el-timeline-item>\r\n\t\t\t\t\t\t<el-card class=\"box-card\">\r\n\t\t\t\t\t\t\t<div slot=\"header\" class=\"clearfix\">\r\n\t\t\t\t\t\t\t\t<span>选择座位类型</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<el-button type=\"primary\" plain style=\"width: 100%\" size=\"small\" @click=\"step3_1()\">\r\n\t\t\t\t\t\t\t\t普通座位\r\n\t\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t\t\t<br /><br />\r\n\t\t\t\t\t\t\t<el-button type=\"primary\" plain style=\"width: 100%\" size=\"small\" @click=\"step3_2()\">\r\n\t\t\t\t\t\t\t\t过道\r\n\t\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t\t</el-card>\r\n\t\t\t\t\t</el-timeline-item>\r\n\r\n\t\t\t\t\t<!-- 第四步 -->\r\n\t\t\t\t\t<el-timeline-item>\r\n\t\t\t\t\t\t<el-card class=\"box-card\">\r\n\t\t\t\t\t\t\t<div slot=\"header\" class=\"clearfix\">\r\n\t\t\t\t\t\t\t\t<span>确认模板</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<el-button type=\"success\" style=\"width: 100%\" size=\"small\" @click=\"step4()\">\r\n\t\t\t\t\t\t\t\t选好了\r\n\t\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t\t</el-card>\r\n\t\t\t\t\t</el-timeline-item>\r\n\t\t\t\t</el-timeline>\r\n\t\t\t</el-aside>\r\n\t\t\t<el-main>\r\n\t\t\t\t<!-- 提示内容 -->\r\n\t\t\t\t<div class=\"tip\">\r\n\t\t\t\t\t<div class=\"tip-item\" style=\"background: #36d6\"></div>\r\n\t\t\t\t\t未选择座位 &nbsp;&nbsp;\r\n\t\t\t\t\t<div class=\"tip-item\" style=\"background: #36d\"></div>\r\n\t\t\t\t\t已选择座位 &nbsp;&nbsp;\r\n\t\t\t\t\t<div class=\"tip-item\" style=\"background: #a11\"></div>\r\n\t\t\t\t\t普通座位 &nbsp;&nbsp;\r\n\t\t\t\t\t<div class=\"tip-item\" style=\"background: #3333\"></div>\r\n\t\t\t\t\t过道\r\n\t\t\t\t</div>\r\n\t\t\t\t<el-divider></el-divider>\r\n\t\t\t\t<el-divider>电影荧屏</el-divider>\r\n\r\n\t\t\t\t<!-- 画布 -->\r\n\t\t\t\t<canvas id=\"canvas\"></canvas>\r\n\t\t\t</el-main>\r\n\t\t</el-container>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport SeatSelector from '@/libs/SeatSelector.js';\r\n\timport httpApi from '@/http';\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\trows: 0,\r\n\t\t\t\tcols: 0,\r\n\t\t\t\tseatSelector: null, // 座位模板对象\r\n\t\t\t\tid: this.$route.params.id, // 放映厅的ID\r\n\t\t\t};\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 生成座位模板，并且绘制在canvas中\r\n\t\t\t */\r\n\t\t\tstep1() {\r\n\t\t\t\tlet row = parseInt(this.rows);\r\n\t\t\t\tlet col = parseInt(this.cols);\r\n\t\t\t\tthis.seatSelector = new SeatSelector(row, col, 'canvas'); // 创建SeatSelector对象  传入行数、列数、canvas\r\n\t\t\t\tthis.seatSelector.draw(); // 将座位模板绘制在canvas中\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 撤销选中\r\n\t\t\t */\r\n\t\t\tstep2() {\r\n\t\t\t\tif (this.seatSelector) {\r\n\t\t\t\t\tthis.seatSelector.setNoSelect();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 设置选中的座位为普通座位\r\n\t\t\t */\r\n\t\t\tstep3_1() {\r\n\t\t\t\tif (this.seatSelector) {\r\n\t\t\t\t\tthis.seatSelector.setSelectedSeatsToNormalSeats();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 设置选中的座位为过道\r\n\t\t\t */\r\n\t\t\tstep3_2() {\r\n\t\t\t\tif (this.seatSelector) {\r\n\t\t\t\t\tthis.seatSelector.setSelectedSeatsToGangway();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 选好了\r\n\t\t\t */\r\n\t\t\tstep4() {\r\n\t\t\t\tif (this.seatSelector) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tlet seat_template = this.seatSelector.getSeatTemplateJsonString();\r\n\t\t\t\t\t\tlet room_size = this.seatSelector.getSeatCount();\r\n\t\t\t\t\t\tlet id = this.id;\r\n\t\t\t\t\t\t// 发送请求，更新放映厅的座位模板\r\n\t\t\t\t\t\t// this.$http.CinemaRoomApi.updateSeatTemplate({\r\n\t\t\t\t\t\thttpApi.cinemaRoomApi\r\n\t\t\t\t\t\t\t.updateSeatTemplate({\r\n\t\t\t\t\t\t\t\tid,\r\n\t\t\t\t\t\t\t\tseat_template,\r\n\t\t\t\t\t\t\t\troom_size,\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\t\t\tconsole.log('更新放映厅的座位模板', res);\r\n\t\t\t\t\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\t\t\t\t\tthis.$message.success('更新放映厅的座位模板完成');\r\n\t\t\t\t\t\t\t\t\tthis.$router.go(-1);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tthis.$message.error(error);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t},\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t#canvas {\r\n\t\tborder: 1px dashed #999;\r\n\t\tborder-radius: 4px;\r\n\t\tdisplay: none;\r\n\t\tmargin: 0 auto;\r\n\t}\r\n\t.tip {\r\n\t\ttext-align: center;\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n\t.tip-item {\r\n\t\tdisplay: inline-block;\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tvertical-align: middle;\r\n\t}\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./CinemaRoomSeatTemplate.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./CinemaRoomSeatTemplate.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CinemaRoomSeatTemplate.vue?vue&type=template&id=3cedb681&scoped=true&\"\nimport script from \"./CinemaRoomSeatTemplate.vue?vue&type=script&lang=js&\"\nexport * from \"./CinemaRoomSeatTemplate.vue?vue&type=script&lang=js&\"\nimport style0 from \"./CinemaRoomSeatTemplate.vue?vue&type=style&index=0&id=3cedb681&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3cedb681\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","slot","_v","model","value","rows","callback","$$v","expression","cols","staticStyle","on","$event","step1","step2","step3_1","step3_2","step4","staticRenderFns","Seat","constructor","x","y","type","selected","SeatSelector","canvasId","canvas","document","getElementById","cvs","getContext","seatSize","margin","seats","i","row","j","width","height","style","display","addEventListener","event","rect","getBoundingClientRect","clientX","left","clientY","top","startPoint","endPoint","selectRect","x1","Math","min","y1","x2","max","y2","seat","bottom","right","draw","clearRect","fillStyle","fillRect","setNoSelect","setSelectedSeatsToNormalSeats","setSelectedSeatsToGangway","getSeatTemplateJsonString","rowNum","rowData","filteredRowData","filter","item","length","colNum","name","str","JSON","stringify","getSeatCount","count","data","seatSelector","id","$route","params","methods","parseInt","col","seat_template","room_size","httpApi","then","res","console","log","code","$message","success","$router","go","error","component"],"sourceRoot":""}