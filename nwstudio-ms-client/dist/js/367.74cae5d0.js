"use strict";(self["webpackChunkbmdstudio_ms_client"]=self["webpackChunkbmdstudio_ms_client"]||[]).push([[367],{8367:function(t,e,s){s.r(e),s.d(e,{default:function(){return S}});var i=function(){var t=this,e=t._self._c;return e("div",[e("el-divider"),e("el-container",[e("el-aside",[e("el-timeline",[e("el-timeline-item",[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("编辑坐标系")])]),e("el-form",{attrs:{"label-width":"60px"}},[e("el-form-item",{attrs:{label:"行数"}},[e("el-input",{attrs:{placeholder:"请输入行数",size:"small"},model:{value:t.rows,callback:function(e){t.rows=e},expression:"rows"}})],1),e("el-form-item",{attrs:{label:"列数"}},[e("el-input",{attrs:{placeholder:"请输入列数",size:"small"},model:{value:t.cols,callback:function(e){t.cols=e},expression:"cols"}})],1),e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.step1()}}},[t._v(" 生成座位模板 ")])],1)],1)],1),e("el-timeline-item",[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("选择座位区域（框选）")])]),e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.step2()}}},[t._v(" 撤销选中 ")])],1)],1),e("el-timeline-item",[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("选择座位类型")])]),e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.step3_1()}}},[t._v(" 普通座位 ")]),e("br"),e("br"),e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.step3_2()}}},[t._v(" 过道 ")])],1)],1),e("el-timeline-item",[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("确认模板")])]),e("el-button",{staticStyle:{width:"100%"},attrs:{type:"success",size:"small"},on:{click:function(e){return t.step4()}}},[t._v(" 选好了 ")])],1)],1)],1)],1),e("el-main",[e("div",{staticClass:"tip"},[e("div",{staticClass:"tip-item",staticStyle:{background:"#36d6"}}),t._v(" 未选择座位    "),e("div",{staticClass:"tip-item",staticStyle:{background:"#36d"}}),t._v(" 已选择座位    "),e("div",{staticClass:"tip-item",staticStyle:{background:"#a11"}}),t._v(" 普通座位    "),e("div",{staticClass:"tip-item",staticStyle:{background:"#3333"}}),t._v(" 过道 ")]),e("el-divider"),e("el-divider",[t._v("电影荧屏")]),e("canvas",{attrs:{id:"canvas"}})],1)],1)],1)},a=[];class l{constructor(t,e){this.x=t,this.y=e,this.type=0,this.selected=!1}}class r{constructor(t,e,s){this.rows=t,this.cols=e,this.canvas=document.getElementById(s),this.cvs=canvas.getContext("2d"),this.seatSize=20,this.margin=5,this.seats=[];for(let i=0;i<t;i++){let t=[];for(let s=0;s<e;s++)t[s]=new l(i,s);this.seats[i]=t}this.canvas.width=e*this.seatSize+(e+1)*this.margin,this.canvas.height=t*this.seatSize+(t+1)*this.margin,this.canvas.style.display="block",this.canvas.addEventListener("mousedown",(t=>{let e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;this.startPoint={x:s,y:i}})),this.canvas.addEventListener("mouseup",(t=>{let e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;this.endPoint={x:s,y:i};let a={x1:Math.min(this.startPoint.x,this.endPoint.x),y1:Math.min(this.startPoint.y,this.endPoint.y),x2:Math.max(this.startPoint.x,this.endPoint.x),y2:Math.max(this.startPoint.y,this.endPoint.y)};for(let l=0;l<this.rows;l++)for(let t=0;t<this.cols;t++){let e=this.seats[l][t],s=l*this.seatSize+(l+1)*this.margin,i=(l+1)*this.seatSize+(l+1)*this.margin,r=t*this.seatSize+(t+1)*this.margin,c=(t+1)*this.seatSize+(t+1)*this.margin;s>a.y2||r>a.x2||i<a.y1||c<a.x1||0==e.type&&(e.selected=!e.selected)}this.draw()}))}draw(){this.cvs.clearRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){let s=this.seats[t][e];1!=s.type?2!=s.type?s.selected?(this.cvs.fillStyle="#36D",this.cvs.fillRect(e*this.seatSize+(e+1)*this.margin,t*this.seatSize+(t+1)*this.margin,this.seatSize,this.seatSize)):(this.cvs.fillStyle="#36D6",this.cvs.fillRect(e*this.seatSize+(e+1)*this.margin,t*this.seatSize+(t+1)*this.margin,this.seatSize,this.seatSize)):(this.cvs.fillStyle="#3333",this.cvs.fillRect(e*this.seatSize+(e+1)*this.margin,t*this.seatSize+(t+1)*this.margin,this.seatSize,this.seatSize)):(this.cvs.fillStyle="#a11",this.cvs.fillRect(e*this.seatSize+(e+1)*this.margin,t*this.seatSize+(t+1)*this.margin,this.seatSize,this.seatSize))}}setNoSelect(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){let s=this.seats[t][e];s.selected=!1}this.draw()}setSelectedSeatsToNormalSeats(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){let s=this.seats[t][e];s.selected&&(s.type=1,s.selected=!1)}this.draw()}setSelectedSeatsToGangway(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){let s=this.seats[t][e];s.selected&&(s.type=2,s.selected=!1)}this.draw()}getSeatTemplateJsonString(){let t=0;for(let s=0;s<this.rows;s++){let e=this.seats[s],i=e.filter((t=>2!=t.type));if(0==i.length)continue;t+=1;let a=0;for(let l=0;l<this.cols;l++){let e=this.seats[s][l];if(0==e.type)throw"还有未分配的座位";1==e.type&&(a+=1,e.name=`${t}排${a}号`)}}let e=JSON.stringify(this.seats);return e}getSeatCount(){let t=0;for(let e=0;e<this.rows;e++)for(let s=0;s<this.cols;s++){let i=this.seats[e][s];1==i.type&&t++}return t}}var c=r,n=s(1294),h={data(){return{rows:0,cols:0,seatSelector:null,id:this.$route.params.id}},methods:{step1(){let t=parseInt(this.rows),e=parseInt(this.cols);this.seatSelector=new c(t,e,"canvas"),this.seatSelector.draw()},step2(){this.seatSelector&&this.seatSelector.setNoSelect()},step3_1(){this.seatSelector&&this.seatSelector.setSelectedSeatsToNormalSeats()},step3_2(){this.seatSelector&&this.seatSelector.setSelectedSeatsToGangway()},step4(){if(this.seatSelector)try{let t=this.seatSelector.getSeatTemplateJsonString(),e=this.seatSelector.getSeatCount(),s=this.id;n.Z.cinemaRoomApi.updateSeatTemplate({id:s,seat_template:t,room_size:e}).then((t=>{console.log("更新放映厅的座位模板",t),200==t.data.code&&(this.$message.success("更新放映厅的座位模板完成"),this.$router.go(-1))}))}catch(t){this.$message.error(t)}}}},o=h,d=s(1001),m=(0,d.Z)(o,i,a,!1,null,"3cedb681",null),S=m.exports}}]);
//# sourceMappingURL=367.74cae5d0.js.map