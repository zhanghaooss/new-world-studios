"use strict";(self["webpackChunkbmdstudio_ms_client"]=self["webpackChunkbmdstudio_ms_client"]||[]).push([[398],{5398:function(e,o,a){a.r(o),a.d(o,{default:function(){return u}});var i=function(){var e=this,o=e._self._c;return o("div",[o("el-form",{ref:"form",staticStyle:{width:"700px"},attrs:{"label-width":"100px",model:e.form,rules:e.rules}},[o("el-form-item",{attrs:{label:"电影院名称",prop:"cinema_name"}},[o("el-input",{model:{value:e.form.cinema_name,callback:function(o){e.$set(e.form,"cinema_name",o)},expression:"form.cinema_name"}})],1),o("el-form-item",{attrs:{label:"选择位置"}},[o("div",{staticStyle:{height:"200px",border:"1px solid #666"},attrs:{id:"mapContainer"}})]),o("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[o("el-input",{model:{value:e.form.address,callback:function(o){e.$set(e.form,"address",o)},expression:"form.address"}})],1),o("el-form-item",{attrs:{label:"省份",prop:"province"}},[o("el-input",{model:{value:e.form.province,callback:function(o){e.$set(e.form,"province",o)},expression:"form.province"}})],1),o("el-form-item",{attrs:{label:"城市",prop:"city"}},[o("el-input",{model:{value:e.form.city,callback:function(o){e.$set(e.form,"city",o)},expression:"form.city"}})],1),o("el-form-item",{attrs:{label:"地区",prop:"district"}},[o("el-input",{model:{value:e.form.district,callback:function(o){e.$set(e.form,"district",o)},expression:"form.district"}})],1),o("el-form-item",{attrs:{label:"经度",prop:"longitude"}},[o("el-input",{model:{value:e.form.longitude,callback:function(o){e.$set(e.form,"longitude",o)},expression:"form.longitude"}})],1),o("el-form-item",{attrs:{label:"纬度",prop:"latitude"}},[o("el-input",{model:{value:e.form.latitude,callback:function(o){e.$set(e.form,"latitude",o)},expression:"form.latitude"}})],1),o("el-form-item",{attrs:{label:"选择标签",prop:"tags"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",multiple:""},model:{value:e.form.tags,callback:function(o){e.$set(e.form,"tags",o)},expression:"form.tags"}},e._l(e.tags,(function(e){return o("el-option",{key:e.id,attrs:{label:e.tagname,value:e.tagname}})})),1)],1),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("更新电影院")])],1)],1)],1)},t=[],n=(a(7658),a(7634)),r=a.n(n),s=a(1294),l={data(){return{tags:[],form:{cinema_name:"",address:"",province:"",city:"",district:"",longitude:"",latitude:"",tags:[]},rules:{cinema_name:[{required:!0,message:"必填",trigger:"blur"}],address:[{required:!0,message:"必填",trigger:"blur"}],province:[{required:!0,message:"必填",trigger:"blur"}],city:[{required:!0,message:"必填",trigger:"blur"}],district:[{required:!0,message:"必填",trigger:"blur"}],longitude:[{required:!0,message:"必填",trigger:"blur"}],latitude:[{required:!0,message:"必填",trigger:"blur"}],tags:[{required:!0,message:"必填",trigger:"change"}]}}},methods:{getCinemaData(){s.Z.cinemaApi.queryCinemaById({id:this.$route.params.cinemaId}).then((e=>{console.log("电影院",e),this.form=e.data.data,this.form.tags=this.form.tags.split(",")}))},getCinemaTags(){s.Z.cinemaApi.queryCinemaTags().then((e=>{console.log("影院标签",e),this.tags=e.data.data}))},initMap(){r().load({key:"cba88d9a52c127f2aac69158bb9c6e1b",version:"2.0",plugins:["AMap.Geocoder"]}).then((e=>{console.log("配置一个地图容器",this.form.longitude,this.form.latitude),this.map=new e.Map("mapContainer",{viewMode:"3D",zoom:14,center:[this.form.longitude,this.form.latitude]});let o=[this.form.longitude,this.form.latitude],a=new e.Marker({position:o});this.map.add(a),this.map.on("click",(o=>{let a=o.lnglat.KL,i=o.lnglat.kT;console.log("绑定点击事件的经纬度",{lng:a,lat:i});let t=new e.Geocoder;t.getAddress([a,i],((e,o)=>{console.log("回填表单",e,o),this.form.address=o.regeocode.formattedAddress;let t=o.regeocode.addressComponent;this.form.province=t.province,this.form.city=t.city?t.city:t.province,this.form.district=t.district,this.form.latitude=i,this.form.longitude=a}))}))})).catch((e=>{console.log(e)}))},submit(){this.$refs["form"].validate((e=>{e&&(this.form.tags=this.form.tags.join(","),this.$refs["form"].clearValidate(),console.log(this.form),s.Z.cinemaApi.updateCinema(this.form).then((e=>{200==e.data.code&&(this.$message({message:"影院修改成功",type:"success"}),this.$router.push("/home/cinema-list"))})))}))}},async mounted(){await this.getCinemaData(),console.log("加载完毕getCinemaData()"),await this.initMap(),console.log("加载完毕initMap()"),await this.getCinemaTags(),console.log("加载完毕getCinemaTags()")}},p=l,c=a(1001),d=(0,c.Z)(p,i,t,!1,null,"42e7d6d2",null),u=d.exports},7634:function(e,o,a){a(7658),function(o,a){e.exports=a()}(0,(function(){function e(e){var i=[];return e.AMapUI&&i.push(o(e.AMapUI)),e.Loca&&i.push(a(e.Loca)),Promise.all(i)}function o(e){return new Promise((function(o,a){var s=[];if(e.plugins)for(var l=0;l<e.plugins.length;l+=1)-1==t.AMapUI.plugins.indexOf(e.plugins[l])&&s.push(e.plugins[l]);if(n.AMapUI===i.failed)a("前次请求 AMapUI 失败");else if(n.AMapUI===i.notload){n.AMapUI=i.loading,t.AMapUI.version=e.version||t.AMapUI.version,l=t.AMapUI.version;var p=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+l+"/main.js",c.onerror=function(e){n.AMapUI=i.failed,a("请求 AMapUI 失败")},c.onload=function(){if(n.AMapUI=i.loaded,s.length)window.AMapUI.loadUI(s,(function(){for(var e=0,a=s.length;e<a;e++){var i=s[e].split("/").slice(-1)[0];window.AMapUI[i]=arguments[e]}for(o();r.AMapUI.length;)r.AMapUI.splice(0,1)[0]()}));else for(o();r.AMapUI.length;)r.AMapUI.splice(0,1)[0]()},p.appendChild(c)}else n.AMapUI===i.loaded?e.version&&e.version!==t.AMapUI.version?a("不允许多个版本 AMapUI 混用"):s.length?window.AMapUI.loadUI(s,(function(){for(var e=0,a=s.length;e<a;e++){var i=s[e].split("/").slice(-1)[0];window.AMapUI[i]=arguments[e]}o()})):o():e.version&&e.version!==t.AMapUI.version?a("不允许多个版本 AMapUI 混用"):r.AMapUI.push((function(e){e?a(e):s.length?window.AMapUI.loadUI(s,(function(){for(var e=0,a=s.length;e<a;e++){var i=s[e].split("/").slice(-1)[0];window.AMapUI[i]=arguments[e]}o()})):o()}))}))}function a(e){return new Promise((function(o,a){if(n.Loca===i.failed)a("前次请求 Loca 失败");else if(n.Loca===i.notload){n.Loca=i.loading,t.Loca.version=e.version||t.Loca.version;var s=t.Loca.version,l=t.AMap.version.startsWith("2"),p=s.startsWith("2");if(l&&!p||!l&&p)a("JSAPI 与 Loca 版本不对应！！");else{l=t.key,p=document.body||document.head;var c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+s+"&key="+l,c.onerror=function(e){n.Loca=i.failed,a("请求 AMapUI 失败")},c.onload=function(){for(n.Loca=i.loaded,o();r.Loca.length;)r.Loca.splice(0,1)[0]()},p.appendChild(c)}}else n.Loca===i.loaded?e.version&&e.version!==t.Loca.version?a("不允许多个版本 Loca 混用"):o():e.version&&e.version!==t.Loca.version?a("不允许多个版本 Loca 混用"):r.Loca.push((function(e){e?a(e):a()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var i;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(i||(i={}));var t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},r={AMap:[],AMapUI:[],Loca:[]},s=[],l=function(e){"function"==typeof e&&(n.AMap===i.loaded?e(window.AMap):s.push(e))};return{load:function(o){return new Promise((function(a,r){if(n.AMap==i.failed)r("");else if(n.AMap==i.notload){var p=o.key,c=o.version,d=o.plugins;p?(window.AMap&&"lbs.amap.com"!==location.host&&r("禁止多种API加载方式混用"),t.key=p,t.AMap.version=c||t.AMap.version,t.AMap.plugins=d||t.AMap.plugins,n.AMap=i.loading,c=document.body||document.head,window.___onAPILoaded=function(t){if(delete window.___onAPILoaded,t)n.AMap=i.failed,r(t);else for(n.AMap=i.loaded,e(o).then((function(){a(window.AMap)}))["catch"](r);s.length;)s.splice(0,1)[0]()},d=document.createElement("script"),d.type="text/javascript",d.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+t.AMap.version+"&key="+p+"&plugin="+t.AMap.plugins.join(","),d.onerror=function(e){n.AMap=i.failed,r(e)},c.appendChild(d)):r("请填写key")}else if(n.AMap==i.loaded)if(o.key&&o.key!==t.key)r("多个不一致的 key");else if(o.version&&o.version!==t.AMap.version)r("不允许多个版本 JSAPI 混用");else{if(p=[],o.plugins)for(c=0;c<o.plugins.length;c+=1)-1==t.AMap.plugins.indexOf(o.plugins[c])&&p.push(o.plugins[c]);p.length?window.AMap.plugin(p,(function(){e(o).then((function(){a(window.AMap)}))["catch"](r)})):e(o).then((function(){a(window.AMap)}))["catch"](r)}else if(o.key&&o.key!==t.key)r("多个不一致的 key");else if(o.version&&o.version!==t.AMap.version)r("不允许多个版本 JSAPI 混用");else{var u=[];if(o.plugins)for(c=0;c<o.plugins.length;c+=1)-1==t.AMap.plugins.indexOf(o.plugins[c])&&u.push(o.plugins[c]);l((function(){u.length?window.AMap.plugin(u,(function(){e(o).then((function(){a(window.AMap)}))["catch"](r)})):e(o).then((function(){a(window.AMap)}))["catch"](r)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},r={AMap:[],AMapUI:[],Loca:[]}}}}))}}]);
//# sourceMappingURL=398.e4075bd7.js.map